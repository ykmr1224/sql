name: CodeRabbit Feedback Reminder
on:
  pull_request_review_comment:
    types: [created]
permissions:
  pull-requests: write
jobs:
  add-reaction-encouragement:
    runs-on: ubuntu-latest
    # if: contains(github.event.comment.user.login, 'coderabbitai')
    steps:
      - uses: actions/github-script@v8
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const comment = context.payload.comment;
            const originalBody = comment.body;
            const feedbackMessage = "\n\n<sub>ğŸ‘‹ Please leave an emoji reaction (ğŸ‘/ğŸ‘) to this comment to help us track effectiveness.</sub>";
            console.log(context);
            console.log(github);
            console.log(github.event);

            // Only add the message if it's not already there
            if (!originalBody.includes("Please leave an emoji reaction")) {
              await github.rest.pulls.updateReviewComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                comment_id: comment.id,
                body: originalBody + feedbackMessage
              });
            }
